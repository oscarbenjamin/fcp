<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>EMAT10006 - Further Computer Programming - </title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="style.css" type="text/css" />
  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
</head>
  <body>
    <div id="header">
        EMAT10006 - Further Computer Programming
    </div>
    <div id="TOC">
      <ul><li><a href="index.html">Site Index</a></li></ul>
<ul>
<li><a href="#using-multiple-files">Using multiple files</a><ul>
<li><a href="#functions">Functions</a></li>
<li><a href="#a-function-in-its-own-file">A function in its own file</a></li>
<li><a href="#download-the-code">Download the code</a></li>
<li><a href="#general-code-setup">General code setup</a></li>
</ul></li>
</ul>
    </div>
    <div id="main">
<h1 id="using-multiple-files">Using multiple files</h1>
<p>Larger C programs (as with any language) should be spread across multiple files. So far all of our work has been in a single .c file. Here we will see how to split our code across different files.</p>
<h2 id="functions">Functions</h2>
<p>The basic unit of code in C is a function. A single function must be defined in a single .c file. However a larger program can be split into many functions and we can put different functions in different files.</p>
<p>Let's take a quick example program:</p>
<pre class="sourceCode C"><code class="sourceCode c"><span class="co">/*</span>
<span class="co"> * factmain.c</span>
<span class="co"> *</span>
<span class="co"> * Main code file for the func program.</span>
<span class="co"> */</span>

<span class="ot">#include &lt;stdio.h&gt;</span>
<span class="ot">#include &lt;stdlib.h&gt;</span>

<span class="co">/* Function declaration */</span>
<span class="dt">int</span> factorial(<span class="dt">int</span> n);

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[])
{
  <span class="co">/* Get the checking out the way first */</span>
  <span class="kw">if</span>(argc != <span class="dv">2</span>) {
    fprintf(stderr, <span class="st">&quot;Usage: ./func.exe N</span><span class="ch">\n</span><span class="st">&quot;</span>);
    <span class="kw">return</span> <span class="dv">1</span>;
  }
  <span class="co">/* We know argc == 2 so argv[1] exists */</span>
  <span class="dt">char</span> *nstr = argv[<span class="dv">1</span>];
  <span class="dt">int</span> n = atoi(nstr);

  <span class="co">/* Note atoi returns 0 for error */</span>
  <span class="kw">if</span>(n &lt;= <span class="dv">0</span>) { <span class="co">// More checking needed for e.g. &quot;123asd&quot;</span>
    fprintf(stderr, <span class="st">&quot;N should be a positive integer</span><span class="ch">\n</span><span class="st">&quot;</span>);
  }

  <span class="co">/* Function call */</span>
  printf(<span class="st">&quot;factorial(%d) = %d</span><span class="ch">\n</span><span class="st">&quot;</span>, n, factorial(n));
  <span class="kw">return</span> <span class="dv">0</span>;
}

<span class="co">/* Function definition */</span>
<span class="dt">int</span> factorial(<span class="dt">int</span> n)
{
  <span class="dt">int</span> nfact = <span class="dv">1</span>;
  <span class="kw">while</span>(n) {
    nfact *= n;
    n--;
  }
  <span class="kw">return</span> nfact;
}</code></pre>
<p>Remember that there are 3 parts to using a function in C:</p>
<ul>
<li>The declaration</li>
<li>The definition (where the actual code goes)</li>
<li>The call (where the function is <em>used</em>)</li>
</ul>
<h2 id="a-function-in-its-own-file">A function in its own file</h2>
<p>So how do we split this into multiple files? We need 3 files for this. In addition to <code>factmain.c</code> we will have <code>factorial.h</code> and <code>factorial.c</code>. The .h file is a <em>header</em> file and is for function declarations. The file <code>factorial.c</code> will have the <em>definition</em> of the factorial function. Then we will have <code>factmain.c</code> which has the <code>main</code> function of the program. Every program must have a single main function: that is the entry point for the execution of the program.</p>
<p>So the above example becomes three files. Firstly there is <code>factorial.h</code>:</p>
<pre class="sourceCode C"><code class="sourceCode c"><span class="co">/* factorial.h */</span>

<span class="co">/* Function declaration */</span>
<span class="dt">int</span> factorial(<span class="dt">int</span> n);</code></pre>
<p>Then there's <code>factorial.c</code>:</p>
<pre class="sourceCode C"><code class="sourceCode c"><span class="co">/* factorial.c */</span>

<span class="co">/* Not needed in this example but usually X.c imports X.h */</span>
<span class="ot">#include &quot;factorial.h&quot;</span>

<span class="co">/* Function definition */</span>
<span class="dt">int</span> factorial(<span class="dt">int</span> n)
{
  <span class="dt">int</span> nfact = <span class="dv">1</span>;
  <span class="kw">while</span>(n) {
    nfact *= n;
    n--;
  }
  <span class="kw">return</span> nfact;
}</code></pre>
<p>Now <code>factmain.c</code> looks like:</p>
<pre class="sourceCode C"><code class="sourceCode c"><span class="co">/*</span>
<span class="co"> * factmain.c</span>
<span class="co"> *</span>
<span class="co"> * Main code file for the func program.</span>
<span class="co"> */</span>

<span class="ot">#include &lt;stdio.h&gt;</span>
<span class="ot">#include &lt;stdlib.h&gt;</span>

<span class="co">/* Including factorial.h makes the factorial function available */</span>
<span class="ot">#include &quot;factorial.h&quot;</span>

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[])
{
  <span class="co">/* Get the checking out the way first */</span>
  <span class="kw">if</span>(argc != <span class="dv">2</span>) {
    fprintf(stderr, <span class="st">&quot;Usage: ./func.exe N</span><span class="ch">\n</span><span class="st">&quot;</span>);
    <span class="kw">return</span> <span class="dv">1</span>;
  }
  <span class="co">/* We know argc == 2 so argv[1] exists */</span>
  <span class="dt">char</span> *nstr = argv[<span class="dv">1</span>];
  <span class="dt">int</span> n = atoi(nstr);

  <span class="co">/* Note atoi returns 0 for error */</span>
  <span class="kw">if</span>(n &lt;= <span class="dv">0</span>) { <span class="co">// More checking needed for e.g. &quot;123asd&quot;</span>
    fprintf(stderr, <span class="st">&quot;N should be a positive integer</span><span class="ch">\n</span><span class="st">&quot;</span>);
  }

  printf(<span class="st">&quot;factorial(%d) = %d</span><span class="ch">\n</span><span class="st">&quot;</span>, n, factorial(n));
  <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<p>Now to compile this we need to tell the compiler to compile both of the .c files (not the .h file):</p>
<pre class="sourceCode C"><code class="sourceCode c">$ gcc factmain.c factorial.c -o fact.exe
$ ./fact.exe <span class="dv">3</span>
factorial(<span class="dv">3</span>) = <span class="dv">6</span></code></pre>
<p>The idea here is that when we tell the compiler to compile a bunch of .c files the compiler will take all that code and put it together to make a single program. To understand why we have to write it the way we did above consider these points:</p>
<ul>
<li><p>There are two stages to compiling an executable: compiling and linking. The compile stage applies to each .c file separately and compiles each to an &quot;object file&quot;. The linker then takes all of the object files and combines them into a single executable.</p></li>
<li><p>When the compiler compiles a .c file it doesn't look in the other .c files. If the code in that file calls a function defined in another .c file then that's fine provided the compiler has seen a declaration of that function. The compiler just needs to know the types of all the arguments and the return type of the function so that it can generate the correct machine code to <em>call</em> that function.</p></li>
<li><p>When the compiler finds a <code>#include</code> statement it goes and reads all of the code in the corresponding .h file. Those .h files should contain the declarations of all the functions used in the .c file that is being compiled.</p></li>
<li><p>After compiling all of the .c files separately the compiler <em>links</em> them. In this step it expects that all the functions that were declared will have be found in exactly one of the object files. It also expects to find a <code>main</code> function somewhere which it uses as the entry point to the program.</p></li>
</ul>
<p>When we define our own .h files we need to <code>#include</code> them with double quotes (<code>&quot;</code>) e.g.</p>
<pre class="sourceCode C"><code class="sourceCode c"><span class="ot">#include &lt;stdio.h&gt;</span>

<span class="ot">#include &quot;factorial.h&quot;</span></code></pre>
<p>In simple terms the double quotes tell the compiler to look for the .h file <em>here</em>. The .h files from the C standard library are stored somewhere else: The compiler knows where to find them as long as we use the angle bracket notation <code>&lt;stdio.h&gt;</code>.</p>
<h2 id="download-the-code">Download the code</h2>
<p>Code is here: <a href="examples/fact-1.0.zip">Fact 1.0</a></p>
<h2 id="general-code-setup">General code setup</h2>
<p>So the general idea is that we have a bunch of files containing C code. Some are .c files and some are .h files. We might for example have:</p>
<pre><code>factorial.h
factorial.c
squareroot.h
squareroot.c
exponential.h
exponential.c
calcmain.c
rpnmain.c
Makefile</code></pre>
<p>The idea is that the bulk of our code is in functions in the various .c files. Those functions are defined in the corresonding .h files. Then we separately have files such as <code>calcmain.c</code> and <code>rpnmain.c</code> that have <code>main</code> functions in. Thos files don't need correspondibg .h files because we would never <code>#include</code> them in another program.</p>
<p>The setup described here would create two programs <code>calc.exe</code> and <code>rpn.exe</code>. Each of them would use some of the other .c and .h files. Our <code>Makefile</code> should look something like</p>
<pre class="sourceCode Makefile"><code class="sourceCode makefile"><span class="dv">all:</span><span class="dt"> calc.exe rpn.exe</span>

<span class="dv">calc.exe:</span><span class="dt"> calcmain.c factorial.h factorial.c squareroot.h squareroot.c exponential.h exponential.c</span>
    gcc calcmain.c factorial.c squareroot.c exponential.c -o calc.exe

<span class="dv">rpn.exe:</span><span class="dt"> rpnmain.c factorial.h factorial.c squareroot.h squareroot.c exponential.h exponential.c</span>
    gcc rpnmain.c factorial.c squareroot.c exponential.c -o rpn.exe</code></pre>
<p>A better way to write that is</p>
<pre class="sourceCode Makefile"><code class="sourceCode makefile"><span class="dt">CFILES </span><span class="ch">=\</span>
    factorial.c\
    squareroot.c\
    exponential.c

<span class="dt">HFILES </span><span class="ch">=\</span>
    factorial.h\
    squareroot.h\
    exponential.h

<span class="dv">all:</span><span class="dt"> calc.exe rpn.exe</span>

<span class="dv">calc.exe:</span><span class="dt"> calcmain.c </span><span class="ch">$(</span><span class="dt">CFILES</span><span class="ch">)</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">HFILES</span><span class="ch">)</span>
    gcc calcmain.c <span class="ch">$(</span><span class="dt">CFILES</span><span class="ch">)</span> -o calc.exe

<span class="dv">rpn.exe:</span><span class="dt"> rpnmain.c </span><span class="ch">$(</span><span class="dt">CFILES</span><span class="ch">)</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">HFILES</span><span class="ch">)</span>
    gcc rpnmain.c <span class="ch">$(</span><span class="dt">CFILES</span><span class="ch">)</span> -o rpn.exe</code></pre>
<p>The idea here is that each <code>*main.c</code> files just contains a <code>main</code> function and all the other code is in other files. The convention is that e.g. <code>rpn.exe</code> has it's <code>main</code> function in the file <code>rpnmain.c</code>.</p>
    </div>
  </body>
</html>
